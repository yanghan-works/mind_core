`awk` 是一个极其强大的文本处理工具，你可以把它看成一个迷你的编程语言。它的绝活是**按列处理文本**，特别擅长从格式化的文本（比如日志、CSV 文件）中提取信息并生成报表。

### 一、核心公式 · `awk` 的思考模式

`awk` 的工作逻辑是：**“当满足这个条件时，就执行这个操作”**。

**`awk '条件 { 操作 }' 文件名`**

- **`条件 (pattern)`**: 可选。决定了什么时候执行操作。比如“当第三列的数字大于100时”。如果省略，就对每一行都执行操作。
    
- **`{ 操作 (action) }`**: 要干的事。比如“打印第一列和第五列”。这是 `awk` 的核心，你可以在大括号里写一小段代码。
    

`awk` 会一行一行地读取文件，对每一行都用你的“条件”去判断一下，如果满足，就执行“操作”。

### 二、内置神器 · `awk` 的独门变量

`awk` 自带了很多超级有用的变量，记住它们，你就掌握了 `awk` 的七成功力！

|   |   |   |
|---|---|---|
|**变量**|**别名/外号**|**解释**|
|`$0`|**当前行**|代表整行文本。|
|`$1, $2 ...`|**列一，列二**|**`awk` 的灵魂！** 代表当前行的第1列、第2列... `awk` 默认用空格或Tab来分列。|
|`NR`|**行号**|Number of Record，当前处理的是第几行。|
|`NF`|**列数**|Number of Fields，当前行总共有多少列。|
|`FS`|**分隔符**|Field Separator，告诉 `awk` 用什么符号来分列。默认是空格。|
|`OFS`|**输出分隔符**|Output Field Separator，打印时用什么符号隔开各列。|

### 三、特殊剧本 · `BEGIN` 和 `END`

这是两个特殊的“条件”，让 `awk` 的能力再上一层楼。

- **`BEGIN { ... }`**: 在处理任何一行文本**之前**执行。最适合用来打印报表的表头，或者初始化你自己的变量。
    
- **`END { ... }`**: 在处理完所有行**之后**执行。最适合用来计算总和、平均值，并打印报表的结尾总结。
    

### 四、关键选项 · 指定分隔符

|   |   |
|---|---|
|**选项**|**效果**|
|`-F`|**指定输入分隔符**。超级重要！比如处理用逗号分隔的 CSV 文件时，你就要用 `-F,`。|

### 五、实战心法 · `awk` 秀操作

来看这位“数据分析师”是如何工作的！

- **打印特定列：显示当前目录下所有文件的文件名**
    
    ```
    ls -l | awk '{print $9}'
    ```
    
    _(ls -l 的输出结果中，第9列正好是文件名)_
    
- **指定分隔符：打印系统中所有用户的用户名**
    
    ```
    awk -F':' '{print $1}' /etc/passwd
    ```
    
    _( `/etc/passwd` 文件用冒号 `:` 分隔，第1列是用户名)_
    
- **条件过滤：显示 `/etc/passwd` 中用户ID大于1000的用户**
    
    ```
    awk -F':' '$3 > 1000 {print $1}' /etc/passwd
    ```
    
    _(第3列是用户ID，我们只打印满足 `$3 > 1000` 这个条件的行的第1列)_
    
- **生成报表：统计 `data.txt` 所有行的第二列数字的总和**
    
    ```
    awk 'BEGIN { print "开始计算总和..." } { sum += $2 } END { print "计算完毕，总和为:", sum }' data.txt
    ```
    
    _(这里我们自定义了一个变量 `sum`，在 `BEGIN` 打印表头，每行累加第二列的值，在 `END` 打印最终结果)_
    
- **综合应用：统计 Nginx 访问日志中每个 IP 的访问次数**
    
    ```
    awk '{counts[$1]++} END {for (ip in counts) print counts[ip], ip}' access.log | sort -nr
    ```
    
    _(这是一个非常强大的例子！它用到了数组 `counts` 来统计第一列（IP地址）出现的次数，最后再打印出来，并用 `sort` 排序)_
    

> `grep` 负责找，`sed` 负责改，而 `awk` 则负责分析和报告。当你需要对有结构的文本进行计算、格式化输出时，`awk` 就是你的不二之选。掌握了它，你就拥有了命令行里的“Excel”！