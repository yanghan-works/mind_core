---
tags: 
aliases: 
created: 2025-07-24 21:53
---

## 什么是 `sed`？

`sed`（Stream EDitor），江湖人称“流编辑器”，它就像一条高效的文本加工流水线。文件内容**逐行**进入“模式空间”（临时操作台），`sed` 在此进行**增、删、改、查**，处理完即输出。因其逐行处理特性，`sed` 能轻松应对超大文件。

### `sed` 与 `grep`、`awk` 的区别

- **`grep`**：是“侦察兵”，只负责**查找**并显示匹配的行，不修改内容。
    
- **`awk`**：是“数据分析大师”，擅长**列处理**和**数据报告**，支持复杂编程逻辑。
    
- **`sed`**：是“文本整形专家”，专注于**行处理**，最突出的是能**修改**文件内容，并支持强大的**后向引用**。
    

### `sed` 的工作原理

1. 打开文件，准备“流水线”。
    
2. 逐行加载内容到“模式空间”。
    
3. 对当前行执行“条件”和“动作”。
    
4. **默认输出**每行；加 `-n`（静默模式）则只在明确使用 `p` 命令时输出。
    

## 如何使用 `sed`？

基本格式：`sed '条件动作' 文件名`

“条件”指定行，“动作”是操作。

### 1. 查找（类似 `grep`）

#### 模糊查找（模式匹配）

```
sed -n '/root/p' 文件名
# 查找并打印所有含 "root" 的行。
```

#### 精确查找（行号）

- **单行：** `sed -n '3p' 文件名`
    
- **连续行：** `sed -n '2,5p' 文件名`
    
- **不连续行：** `sed -n '1p;5p' 文件名`
    

#### 范围模糊查找

```
sed -n '/开始模式/,/结束模式/p' 文件名
# 打印从“开始模式”到“结束模式”之间的内容。
```

#### 高级地址范围

- **从匹配行开始的N行：** `sed -n '/开始模式/,+5p' 文件名`
    
- **从匹配行到下一个N的倍数行：** `sed -n '1~2p' 文件名` (打印1, 3, 5...行)
    

### 2. 替换 (`s`)

`s` 命令是 `sed` 的“变身术”。

`sed 's/旧内容/新内容/g' 文件名`

- `s`：替换命令。
    
- `g`：全局替换（每行所有匹配项）。
    

#### 灵活分隔符

除 `/` 外，可用 `#`、`|` 等： `sed 's#/usr/local#/opt#g' 文件名`

#### 常用选项

- `-i`：**原地修改**。**警告：危险操作！** 强烈建议先不加 `-i` 预览。
    
- `-i.bak`：**先备份再修改**。`-i` 的“安全模式”。
    
- `-r`：**支持扩展正则表达式**（如 `+`, `?`, `|`, `()`），无需转义。
    

### 3. 反向引用（Back-references）与 `&`

捕获[[正则表达式]] `()` 内匹配的内容，用 `\1`, `\2` 等引用。`&`（或 `\0`）代表整个匹配字符串。

**示例：** `echo "123456789" | sed -r 's/(1)(.*)(8)/<\1>\2<\3>/g'` 输出: `<1>234567<8>9` `echo "Hello World" | sed 's/World/&, Linux!/g'` 输出: `Hello World, Linux!`

### 4. 删除 (`d`)

`d` 命令用于删除行，像“剪刀手爱德华”。

`sed '/要删除的模式/d' 文件名`

**示例：** `sed '3d' 文件名` / `sed '2,5d' 文件名` / `sed '/^#/d' 文件名`

### 5. 增加（插入/追加/替换整行）

- `a`：**追加**到匹配行的**下一行**。 `sed '/模式/a\新追加的内容' 文件名` （多行追加用 `\` 分隔）
    
- `i`：**插入**到匹配行的**上一行**。 `sed '/模式/i\新插入的内容' 文件名`
    
- `c`：**替换**匹配的**整行**。 `sed '/模式/c\新替换的行内容' 文件名`
    

### 6. 取反 (`!`)

`!` 对条件取反，对**不**符合条件的行执行动作。

`sed '/模式/!d' 文件名` (只保留匹配“模式”的行)

### 7. 多命令执行（组合技）

- **分号 `;` 分隔：** `sed 's/old/new/g; s/another/something_else/g' 文件名`
    
- **`-e` 选项：** `sed -e 's/old/new/g' -e 's/another/something_else/g' 文件名`