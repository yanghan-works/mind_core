---
tags: 
aliases: 
created: 2025-07-24 21:53
---

## 什么是 `sed`？

`sed`（Stream EDitor），江湖人称“流编辑器”，它就像一条高效的文本加工流水线。想象一下，文件里的每一行数据，就像工厂里一个个待加工的零件。这些零件不是一股脑全堆进来，而是**一个接一个地**被送进工人的**临时操作台**（这就是“模式空间”）。工人（`sed`）在这个操作台上对当前零件进行检查和处理（增删改查），处理完了，就把它放到成品区（输出），然后等待下一个零件进来。这个操作台一次只放一个零件，所以 `sed` 才能处理超大的文件，因为它不需要把整个文件都装进脑子里！

`sed` 的核心功能可以概括为对文本内容的**增、删、改、查**。

### `sed` 与 `grep`、`awk` 的区别

- **`grep`**：就像一个“火眼金睛”的侦察兵，它的任务是**查找**（过滤）符合特定模式的行，然后把这些行给你看。它只会显示匹配的行，不能直接修改文件内容。
    
- **`awk`**：则是一个“数据分析大师”，更擅长**列处理**和**数据报告**。它能根据字段（列）进行操作，并支持更复杂的编程逻辑，就像一个迷你编程语言。
    
- **`sed`**：专注于**行处理**，它是“文本整形专家”。最显著的特点是它能够**修改**文件内容（原地修改或输出修改后的内容）。它还支持强大的**后向引用**（Back-reference）功能，可以截取匹配到的内容进行重组或加工，就像变魔术一样。
    

### `sed` 的工作原理

当 `sed` 命令被执行时：

1. 它打开文件，建立连接，准备好“流水线”。
    
2. 从硬盘中逐行加载内容到内存中的“模式空间”（临时操作台）。
    
3. 对模式空间中的当前行执行指定的“条件”和“动作”。
    
4. **默认情况下**，`sed` 会在处理完每一行后将其输出。但如果你加上 `-n` 选项（静默模式），`sed` 就会“闭嘴”，只有当你明确使用 `p`（打印）命令时，它才会输出内容。
    

## 如何使用 `sed`？

基本的 `sed` 命令格式是：

```
sed '条件动作' 文件名
```

这里的“条件”指定了要操作的行（例如行号或匹配模式），“动作”则是对这些行执行的操作（例如打印、替换、删除等）。

### 1. 查找（类似 `grep`）

#### 模糊查找（通过模式匹配）

查找包含特定字符串的行并打印：

```
sed '/root/p' 文件名
# 查找文件中所有包含 "root" 的行并打印。注意：由于默认行为是打印所有行，
# 如果不加 -n，匹配的行会被打印两次（一次是sed默认打印，一次是p命令打印）。
# 推荐用法：sed -n '/root/p' 文件名，这样只打印匹配的行。
```

#### 精确查找（通过行号）

- **取单行：**
    
    ```
    sed -n '3p' 文件名
    # 打印文件中的第3行。加上 -n 确保只打印这一行。
    ```
    
- **取连续行：**
    
    ```
    sed -n '2,5p' 文件名
    # 打印文件中的第2到第5行（包括第2和第5行）。
    ```
    
- **取不连续行：** 使用分号 `;` 分隔多个命令。
    
    ```
    sed -n '1p;5p' 文件名
    # 打印文件中的第1行和第5行。
    ```
    

#### 范围模糊查找

查找从第一个匹配模式的行到第二个匹配模式的行之间的所有行：

```
sed -n '/开始模式/,/结束模式/p' 文件名
# 打印从匹配 "开始模式" 的行到匹配 "结束模式" 的行之间的所有内容。
```

#### 高级地址范围（小彩蛋）

- **从匹配行开始的N行：**
    
    ```
    sed -n '/开始模式/,+5p' 文件名
    # 打印从匹配 "开始模式" 的行开始，包括该行在内的后面5行。
    ```
    
- **从匹配行到下一个N的倍数行：**
    
    ```
    sed -n '1~2p' 文件名
    # 打印从第1行开始，每隔2行打印一次（即打印1, 3, 5...行）。
    ```
    

### 2. 替换 (`s`)

`s` 命令用于替换文本，它是 `sed` 的“变身术”。

```
sed 's/旧内容/新内容/g' 文件名
# 将文件中所有行内的“旧内容”替换为“新内容”
```

- `s`：表示替换（substitute）命令。
    
- `旧内容`：要查找的字符串或正则表达式。
    
- `新内容`：替换后的字符串。
    
- `g`：全局替换标志（global）。如果没有 `g`，则每行只替换第一个匹配项。
    

#### 替换命令的灵活分隔符

除了斜杠 `/`，你还可以使用其他字符作为 `s` 命令的分隔符，这在替换包含斜杠的路径时特别方便，避免了繁琐的转义。

```
sed 's#/usr/local#/opt#g' 文件名   # 使用 # 作为分隔符
sed 's|old_path|new_path|g' 文件名   # 使用 | 作为分隔符
```

#### 常用选项

- `-i`：**原地修改**文件内容。**警告：这是个“危险动作”！** 一旦执行，文件内容就直接变了，没有后悔药。**强烈建议**先不加 `-i` 运行命令，确认输出无误后再使用。
    
    ```
    sed -i 's/hello/aaaa/g' 文件名
    # 直接修改文件，将所有 "hello" 替换为 "aaaa"
    ```
    
- `-i.bak`：**先备份再原地修改**。这会创建一个原始文件的备份（例如 `文件名.bak`），然后修改原文件。这是 `-i` 的“安全模式”。
    
    ```
    sed -i.bak 's/hello/aaaa/g' 文件名
    # 备份文件为 文件名.bak，然后修改原文件
    ```
    
- `-r`：**支持扩展正则表达式**（Extended Regular Expressions）。这样可以使用 `+`, `?`, `|`, `()` 等更方便的正则符号，而无需转义，让你的正则表达式更简洁。
    
    ```
    sed -r 's/(hello)+/hi/g' 文件名
    # 使用扩展正则表达式，将一个或多个 "hello" 替换为 "hi"
    ```
    

### 3. 反向引用（Back-references）与 `&`

反向引用是 `sed` 中一个非常强大的“魔术”，它允许你捕获正则表达式中匹配到的部分内容，并在替换字符串中引用这些被捕获的部分。这对于对文本的某一部分进行加工或提取非常有用。

在[[正则表达式]]中，使用 `()` 来创建分组。在替换字符串中，使用 `\1`, `\2` 等来引用这些分组捕获的内容。

另外，`&` 符号（或 `\0`）则代表整个匹配到的字符串。

**示例：** 对行内的数字进行加工

```
echo "123456789" | sed -r 's/(1)(.*)(8)/<\1>\2<\3>/g'
# 输出: <1>234567<8>9
# 解释:
# (1) 匹配并捕获第一个字符 '1' (对应 \1)
# (.*) 匹配并捕获任意数量的字符 (对应 \2)
# (8) 匹配并捕获字符 '8' (对应 \3)
# 替换为 '<' + \1 的内容 + '>' + \2 的内容 + '<' + \3 的内容 + '>'

echo "Hello World" | sed 's/World/&, Linux!/g'
# 输出: Hello World, Linux!
# 解释: & 代表匹配到的 "World"，所以替换成了 "World, Linux!"
```

### 4. 删除 (`d`)

`d` 命令用于删除行，就像“剪刀手爱德华”一样，精准剪掉不需要的行。

```
sed '/要删除的模式/d' 文件名
# 删除文件中所有匹配“要删除的模式”的行
```

**示例：**

```
sed '3d' 文件名        # 删除第3行
sed '2,5d' 文件名      # 删除第2到第5行
sed '/^#/d' 文件名     # 删除所有以 '#' 开头的注释行
```

### 5. 增加（插入/追加/替换整行）

- `a`：**追加**（append）内容到匹配行的**下一行**。
    
    ```
    sed '/模式/a\新追加的内容' 文件名
    # 在匹配“模式”的每一行后面追加“新追加的内容”。
    # 如果要追加多行，每行末尾加反斜杠 \，最后一行不加。
    # sed '/模式/a\第一行内容\
    # 第二行内容' 文件名
    ```
    
- `i`：**插入**（insert）内容到匹配行的**上一行**。
    
    ```
    sed '/模式/i\新插入的内容' 文件名
    # 在匹配“模式”的每一行前面插入“新插入的内容”。
    ```
    
- `c`：**替换**（change）匹配的**整行**。
    
    ```
    sed '/模式/c\新替换的行内容' 文件名
    # 将匹配“模式”的整行替换为“新替换的行内容”。
    ```
    

### 6. 取反 (`!`)

`!` 用于对条件取反。这意味着对**不**符合条件的行执行动作，就像“反向操作”一样。

```
sed '/模式/!d' 文件名
# 删除所有不匹配“模式”的行（即只保留匹配“模式”的行）
```

### 7. 多命令执行（组合技）

你可以在一个 `sed` 命令中执行多个操作，就像施展“组合拳”一样。

- **使用分号 `;` 分隔：**
    
    ```
    sed 's/old/new/g; s/another/something_else/g' 文件名
    # 先替换 "old" 为 "new"，再替换 "another" 为 "something_else"
    ```
    
- **使用 `-e` 选项：**
    
    ```
    sed -e 's/old/new/g' -e 's/another/something_else/g' 文件名
    # 效果同上，更清晰，尤其是在脚本中。
    ```